function activeStates(){window.location.href.indexOf("messages")>-1?$(".forum-tabs .inbox").addClass("active"):$(".forum-tabs .forum").addClass("active"),$(".custom-header-links .talk").addClass("active")}function addActive(e){$(".forum-tabs .active").removeClass("active"),e.classList.add("active")}function createUI(){if(!$(".hamburger-dropdown-menu-items").length){var e="<div class='hamburger-dropdown-menu-items' style='display: none;'><ul class='hamburger-dropdown-menu'></ul></div>";$(e).insertAfter(".d-header .wrap .contents")}if(!$(".user-dropdown-menu-items").length){var e="<div class='user-dropdown-menu-items' style='display: none;'><ul class='user-dropdown-menu'></ul></div>";$(e).insertAfter(".d-header .wrap .contents")}}function createNotificationUI(){if(!$(".toggle-notifications-menu").length){var e='<a href="#" class="toggle-notifications-menu"><svg class="notification-bell"></svg><span class="bell-icon-active"></span></a>';$(".notification-icon").append(e)}if(!$(".notification-menu-items").length){var e='<ul class="dropdown-menu-items notification-menu-items" style="display: none;"><li><a>You are up to date!</a></li></ul>';$(e).insertAfter(".d-header .wrap .contents")}}function changeForumNavigation(){$("#create-topic").addClass("d-none"),$("#create-topic .d-button-label").text("New Topic"),$("#create-topic").removeClass("d-none");$("<p class='forum-nav-text'><strong>A place to discuss all things repair: advice, activism, and more.</strong> Join in! Anyone can post a topic.</p>").insertAfter("#create-topic")}function activateSearch(){$("#search-button-123").click(function(){$("#search-button").trigger("click")}),$(document).mouseup(function(e){var t=$(".search-menu");t.is(e.target)||0!==t.has(e.target).length||t.hide()})}function isLoggedIn(){$(".login-button").length||$("body").addClass("logged-in")}function defineClicks(){$(".notification-icon").click(function(e){e.preventDefault(),$("a.dropdown-active").not(".toggle-notifications-menu").removeClass("dropdown-active"),$(".user-dropdown-menu-items, .hamburger-dropdown-menu-items").hide(),$(".toggle-notifications-menu").toggleClass("dropdown-active"),$(".notification-menu-items").toggle()}),$(".restarters-hamburger-toggle").click(function(e){e.preventDefault(),$("a.dropdown-active").not(".toggle-hamburger-menu").removeClass("dropdown-active"),$(".user-dropdown-menu-items, .notification-menu-items").hide(),$(".toggle-hamburger-menu").toggleClass("dropdown-active"),$(".hamburger-dropdown-menu-items").toggle()}),$(".restarters-user-toggle").click(function(e){e.preventDefault(),$("a.dropdown-active").not(".toggle-user-menu").removeClass("dropdown-active"),$(".hamburger-dropdown-menu-items, .notification-menu-items").hide(),$(".toggle-user-menu").toggleClass("dropdown-active"),$(".user-dropdown-menu-items").toggle()})}function clearDropdowns(){$("a.dropdown-active").removeClass("dropdown-active"),$(".user-dropdown-menu-items, .hamburger-dropdown-menu-items, .notification-menu-items").hide()}function navigateUrl(e){$("#messages-dropdown").on("change",function(){location.href=document.location.origin+$(this).val()})}function checkAuth(){$.ajax({headers:{"Content-Type":"application/x-www-form-urlencoded"},xhrFields:{withCredentials:!0},type:"GET",url:"https://test-restarters.rstrt.org/test/check-auth",datatype:"json",success:function(e){var e=e.data;!0===e.authenticated&&(ajaxSearchNotifications(),$main_navigation_dropdown=$(".hamburger-dropdown-menu"),$main_navigation_dropdown.empty(),e.is_admin&&($("body").addClass("is_admin"),$.each(e.menu.reporting,function(e,t){var n=e.includes("spacer");e.includes("header")?$main_navigation_dropdown.append($("<li>").attr("class","dropdown-menu-header").text(t)):n?$main_navigation_dropdown.append($("<li>").attr("class","dropdown-spacer")):$main_navigation_dropdown.append($("<li>").append($("<a>").attr("href",t).text(e)))})),$.each(e.menu.general,function(e,t){$main_navigation_dropdown.append($("<li>").append($("<a>").attr("href",t).text(e)))}),e.menu&&($auth_menu_items=$(".user-dropdown-menu"),$auth_menu_items.empty(),$.each(e.menu.user,function(e,t){var n=e.includes("spacer");e.includes("header")?$auth_menu_items.append($("<li>").attr("class","dropdown-menu-header").text(t)):n?$auth_menu_items.append($("<li>").attr("class","dropdown-spacer")):$auth_menu_items.append($("<li>").append($("<a>").attr("href",t).text(e)))})))}})}function ajaxSearchNotifications(){$.ajax({headers:{"Content-Type":"application/x-www-form-urlencoded"},xhrFields:{withCredentials:!0},type:"GET",url:"https://test-restarters.rstrt.org/test/discourse/notifications",datatype:"json",success:function(e){if("failed"==e.message)return!1;var t=e.notifications;Object.keys(t).length>0?($("body").addClass("has-notifications"),$notification_menu_items=$(".notification-menu-items"),$notification_menu_items.empty(),$.each(t,function(e,t){$notification_menu_items.append($("<li>").append($("<a>").attr("href","https://test-restarters.rstrt.org/notifications/"+t.id).attr("class","notification-link").text(t.data.title)).attr("class","notifcation-text"))})):$("body").removeClass("has-notifications")}})}function goToNotification(){$(".notification-link").click(function(){document.location.href=$(this).attr("href")})}setTimeout(function(){activeStates(),createUI(),createNotificationUI(),changeForumNavigation(),activateSearch(),isLoggedIn(),checkAuth(),defineClicks(),navigateUrl(),new MutationObserver(function(e){e.forEach(function(e){if("class"===e.attributeName){createNotificationUI(),clearDropdowns(),checkAuth(),defineClicks();$(e.target).prop(e.attributeName)}})}).observe(document.getElementsByClassName("d-header").item(0),{attributes:!0})},1500);
